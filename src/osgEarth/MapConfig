#ifndef OSGEARTH_MAP_CONFIG_H
#define OSGEARTH_MAP_CONFIG_H 1

#include <osgEarth/Common>
#include <map>
#include <list>

namespace osgEarth
{
    typedef std::map<std::string,std::string> SourceProperties;

    /**
     * Defines a source for image or heightfield data.
     */
    class OSGEARTH_EXPORT SourceConfig : public osg::Referenced
    {
    public:
        SourceConfig();

        /**
         * Sets the readable name of the source.
         */
        void setName( const std::string& name );

        const std::string& getName() const;

        /**
         * Sets the driver name for this source. The driver name is the
         * name of the extension that will load the appropriate osg plugin.
         */
        void setDriver( const std::string& driver );

        const std::string& getDriver() const;

        /**
         * Gets the collection of name/value pairs that the tile generator
         * will pass to the OSG plugin designated by the driver setting.
         */
        SourceProperties& getProperties();

        const SourceProperties& getProperties() const;

    private:
        std::string name;
        std::string driver;
        SourceProperties properties;
    };

    typedef std::list< osg::ref_ptr<SourceConfig> > SourceConfigList;


    class OSGEARTH_EXPORT MapConfig : public osg::Referenced
    {
    public:
        enum CoordinateSystemType
        {
            CSTYPE_GEOCENTRIC,
            CSTYPE_PLATE_CARRE
        };

    public:
        /**
         * Constructs a new, empty map configuration.
         */
        MapConfig();

        /**
         * Sets the readable name of the map.
         */
        void setName( const std::string& name );

        const std::string& getName() const;
        
        /**
         * Gets the coordinate system type for this map, e.g. round-earth (geocentric)
         * or flat-earth (plate carre, etc.)
         *
         * @return A CoordinateSystemType
         */
        const CoordinateSystemType& getCoordinateSystemType() const;

        /**
         * Sets the coordinate system type for this map.
         *
         * @param type
         *      Type of CS to use for the 3D map
         */
        void setCoordinateSystemType( const CoordinateSystemType& type );

        /**
         * Sets the default scale factor for height-field values.
         *
         * @param scale
         *      Multiplier for heights; default = 1.0
         */
        void setVerticalScale( float scale );

        /**
         * Gets the default scale factor for height-field values.
         */
        float getVerticalScale() const;

        SourceConfigList& getImageSources();

        const SourceConfigList& getImageSources() const;

        SourceConfigList& getHeightFieldSources();

        const SourceConfigList& getHeightFieldSources() const;
        
        /**
        *Sets the skirt ratio to be used when creating height field tiles
        *
        *@param skirtRatio
        *      The skirt ratio; default = 0.02
        */
        void setSkirtRatio(const float _skirt_ratio) { skirt_ratio = _skirt_ratio; }
        
        /**
        *Gets the skirt ratio to be used when creating height field tiles
        *
        *@return The skirt ratio
        */
        float getSkirtRatio() const { return skirt_ratio; }
        

    private:
        std::string name;
        CoordinateSystemType cstype;
        float vertical_scale;
        float skirt_ratio;      
        SourceConfigList image_sources;
        SourceConfigList heightfield_sources;       
    };


    /**
     * Creates MapConfig objects from their XML description.
     */
    class OSGEARTH_EXPORT MapConfigReader
    {
    public:
        static MapConfig* readXml( const std::string& location );
        static MapConfig* readXml( std::istream& input );
    };
};

#endif // OSGEARTH_MAP_CONFIG_H